package com.mobiddiction.fishsmart.Maps;

import android.os.AsyncTask;
import android.util.Log;

import com.mobiddiction.fishsmart.Configuration.Config;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.lang.ref.WeakReference;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;

import javax.net.ssl.HttpsURLConnection;

/**
 * Created by Archa on 12/10/2015.
 */
public class MapAsync extends AsyncTask<String, Void, Integer> {

    private WeakReference<MapsActivity> activity;
    ArrayList<MapModel> MapList = new ArrayList<MapModel>();  //safe
    ArrayList<PinsModel> PinsList = new ArrayList<PinsModel>();  //safe

    public MapAsync(MapsActivity fragment, ArrayList mapList) {
        activity = new WeakReference<>(fragment);
        this.MapList = mapList;
    }

    @Override
    protected void onPreExecute() {
      //  activity.progress_bar.setVisibility(View.VISIBLE);
    }

    @Override
    protected Integer doInBackground(String... params) {

        Integer result = 0;

        try {

            URL url = new URL(Config.HOST + params[0]);

            Log.d("map url ","" + url);

            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setReadTimeout(15000);
            conn.setConnectTimeout(15000);
            conn.setRequestMethod("GET");
            conn.setDoInput(true);
            //  conn.setDoOutput(false);
            conn.setInstanceFollowRedirects(false);
            conn.setRequestProperty("X-Requested-With", "XMLHttpRequest");

            int responseCode = conn.getResponseCode();

            Log.d("LOG", "responsecode " + responseCode);

            if (responseCode == HttpsURLConnection.HTTP_OK) {
                String line;
                BufferedReader br = new BufferedReader(new InputStreamReader(conn.getInputStream()));
                StringBuilder response = new StringBuilder();
                while ((line = br.readLine()) != null) {
                    response.append(line);
                }

                Log.d("LOG", "Map response : " + response);

                parseResult(response.toString());

                result = 1; // Successful
            }
            else
            {
                //  parseResult("");
                result = 0;
            }

        } catch (Exception e) {
            e.printStackTrace();
        }

        return result;
    }

    @Override
    protected void onPostExecute(Integer result)
    {
        MapsActivity context = activity.get();
        if (context != null) {
            if (result == 1)
            {
                context.receiveItems();
            }
        }
    }

    private void parseResult(String response) {

        try {

            MapsActivity context = activity.get();
            if (context != null) {
                MapList.clear();
                PinsList.clear();

                context.marineItemList.clear();
                context.overlayItemList.clear();
                context.fishItemList.clear();
            }



           // response = "{\"success\":true,\"response\":\"Please collect all the map data with mapType as MARINEPARKZONES.\",\"data\":[{\"id\":805,\"color\":\"#b1c9a8\",\"mapType\":\"MARINE PARK ZONES\",\"topLeftLat\":-33.997581976266070,\"topLeftLon\":151.237303676481100,\"bottomRightLat\":-34.002715985491120,\"bottomRightLon\":151.251024869457400,\"mapPins\":[{\"id\":57855,\"lat\":-33.997766832800000,\"lon\":151.246162626000000},{\"id\":57856,\"lat\":-33.997581976300000,\"lon\":151.245824497000000},{\"id\":57857,\"lat\":-33.997603758700000,\"lon\":151.245428718000000},{\"id\":57858,\"lat\":-33.997889395100000,\"lon\":151.245067040000000},{\"id\":57859,\"lat\":-33.997916198500000,\"lon\":151.244638203000000},{\"id\":57860,\"lat\":-33.998324856700000,\"lon\":151.244438719000000},{\"id\":57861,\"lat\":-33.998441541100000,\"lon\":151.244501583000000},{\"id\":57862,\"lat\":-33.998593964500000,\"lon\":151.244379906000000},{\"id\":57863,\"lat\":-33.998747814200000,\"lon\":151.243924850000000},{\"id\":57864,\"lat\":-33.999105198500000,\"lon\":151.243473012000000},{\"id\":57865,\"lat\":-33.999160998700000,\"lon\":151.243494086000000},{\"id\":57866,\"lat\":-33.999227019700000,\"lon\":151.243366797000000},{\"id\":57867,\"lat\":-33.999283142800000,\"lon\":151.243410085000000},{\"id\":57868,\"lat\":-33.999343308400000,\"lon\":151.243305133000000},{\"id\":57869,\"lat\":-33.999485208800000,\"lon\":151.243309616000000},{\"id\":57870,\"lat\":-33.999483199700000,\"lon\":151.243168908000000},{\"id\":57871,\"lat\":-33.999667508600000,\"lon\":151.243120663000000},{\"id\":57872,\"lat\":-33.999635408200000,\"lon\":151.243032431000000},{\"id\":57873,\"lat\":-33.999875671100000,\"lon\":151.242582995000000},{\"id\":57874,\"lat\":-34.000082522300000,\"lon\":151.242386119000000},{\"id\":57875,\"lat\":-34.000018753200000,\"lon\":151.242239272000000},{\"id\":57876,\"lat\":-34.000085723900000,\"lon\":151.242178631000000},{\"id\":57877,\"lat\":-33.999926416200000,\"lon\":151.241818914000000},{\"id\":57878,\"lat\":-33.999765063400000,\"lon\":151.241748163000000},{\"id\":57879,\"lat\":-33.999680658500000,\"lon\":151.241883240000000},{\"id\":57880,\"lat\":-33.999623692700000,\"lon\":151.241780701000000},{\"id\":57881,\"lat\":-33.999513363000000,\"lon\":151.241827412000000},{\"id\":57882,\"lat\":-33.999435547300000,\"lon\":151.241992019000000},{\"id\":57883,\"lat\":-33.998720536000000,\"lon\":151.241584479000000},{\"id\":57884,\"lat\":-33.998491184600000,\"lon\":151.241070655000000},{\"id\":57885,\"lat\":-33.998353819400000,\"lon\":151.241001148000000},{\"id\":57886,\"lat\":-33.998384262400000,\"lon\":151.240823949000000},{\"id\":57887,\"lat\":-33.998291089900000,\"lon\":151.240614953000000},{\"id\":57888,\"lat\":-33.998411046000000,\"lon\":151.240373061000000},{\"id\":57889,\"lat\":-33.998278118100000,\"lon\":151.239708848000000},{\"id\":57890,\"lat\":-33.998472476000000,\"lon\":151.238894435000000},{\"id\":57891,\"lat\":-33.998729643400000,\"lon\":151.238801791000000},{\"id\":57892,\"lat\":-33.998705091000000,\"lon\":151.238569642000000},{\"id\":57893,\"lat\":-33.999385930000000,\"lon\":151.237303676000000},{\"id\":57894,\"lat\":-33.999607201800000,\"lon\":151.237807222000000},{\"id\":57895,\"lat\":-33.999655935200000,\"lon\":151.238736198000000},{\"id\":57896,\"lat\":-33.999559271600000,\"lon\":151.239232944000000},{\"id\":57897,\"lat\":-33.999213637800000,\"lon\":151.239831387000000},{\"id\":57898,\"lat\":-33.999296437500000,\"lon\":151.240581873000000},{\"id\":57899,\"lat\":-33.999402037700000,\"lon\":151.240731118000000},{\"id\":57900,\"lat\":-33.999742643300000,\"lon\":151.240665135000000},{\"id\":57901,\"lat\":-34.000033783600000,\"lon\":151.240713956000000},{\"id\":57902,\"lat\":-34.000548398100000,\"lon\":151.241034058000000},{\"id\":57903,\"lat\":-34.000932681100000,\"lon\":151.241805017000000},{\"id\":57904,\"lat\":-34.000984090000000,\"lon\":151.242430104000000},{\"id\":57905,\"lat\":-34.000874910500000,\"lon\":151.242904339000000},{\"id\":57906,\"lat\":-34.000360462300000,\"lon\":151.243814534000000},{\"id\":57907,\"lat\":-34.000004974700000,\"lon\":151.244195180000000},{\"id\":57908,\"lat\":-33.999626005800000,\"lon\":151.244422501000000},{\"id\":57909,\"lat\":-33.999286912800000,\"lon\":151.245073778000000},{\"id\":57910,\"lat\":-33.998901678300000,\"lon\":151.245433050000000},{\"id\":57911,\"lat\":-33.999213217000000,\"lon\":151.245796126000000},{\"id\":57912,\"lat\":-33.999358179600000,\"lon\":151.246103176000000},{\"id\":57913,\"lat\":-33.999413242400000,\"lon\":151.246449877000000},{\"id\":57914,\"lat\":-33.999368395900000,\"lon\":151.246947392000000},{\"id\":57915,\"lat\":-33.999666680300000,\"lon\":151.246972564000000},{\"id\":57916,\"lat\":-33.999913795100000,\"lon\":151.247093571000000},{\"id\":57917,\"lat\":-34.000606897200000,\"lon\":151.246721821000000},{\"id\":57918,\"lat\":-34.001294804800000,\"lon\":151.246708473000000},{\"id\":57919,\"lat\":-34.001660883800000,\"lon\":151.246929580000000},{\"id\":57920,\"lat\":-34.002299968100000,\"lon\":151.247773470000000},{\"id\":57921,\"lat\":-34.002679464000000,\"lon\":151.248904856000000},{\"id\":57922,\"lat\":-34.002711185800000,\"lon\":151.249325858000000},{\"id\":57923,\"lat\":-34.002632845900000,\"lon\":151.249666056000000},{\"id\":57924,\"lat\":-34.002380104000000,\"lon\":151.250163556000000},{\"id\":57925,\"lat\":-34.002033276900000,\"lon\":151.250591617000000},{\"id\":57926,\"lat\":-34.001549011700000,\"lon\":151.250897190000000},{\"id\":57927,\"lat\":-34.001069146100000,\"lon\":151.251024869000000},{\"id\":57928,\"lat\":-34.000422276300000,\"lon\":151.250937177000000},{\"id\":57929,\"lat\":-34.000019457400000,\"lon\":151.250630275000000},{\"id\":57930,\"lat\":-33.999532113000000,\"lon\":151.250845942000000},{\"id\":57931,\"lat\":-33.998950623000000,\"lon\":151.250795414000000},{\"id\":57932,\"lat\":-33.998623079100000,\"lon\":151.250666866000000},{\"id\":57933,\"lat\":-33.998554778300000,\"lon\":151.250742954000000},{\"id\":57934,\"lat\":-33.998125601200000,\"lon\":151.249694712000000},{\"id\":57935,\"lat\":-33.998279975200000,\"lon\":151.249645205000000},{\"id\":57936,\"lat\":-33.998521016000000,\"lon\":151.249186428000000},{\"id\":57937,\"lat\":-33.998668411300000,\"lon\":151.249425569000000},{\"id\":57938,\"lat\":-33.999104688600000,\"lon\":151.249727969000000},{\"id\":57939,\"lat\":-33.999072281500000,\"lon\":151.249474933000000},{\"id\":57940,\"lat\":-33.999159313400000,\"lon\":151.249519278000000},{\"id\":57941,\"lat\":-33.999282918000000,\"lon\":151.249436020000000},{\"id\":57942,\"lat\":-33.999344760800000,\"lon\":151.249734576000000},{\"id\":57943,\"lat\":-33.999450823200000,\"lon\":151.249766988000000},{\"id\":57944,\"lat\":-33.999571146200000,\"lon\":151.249453168000000},{\"id\":57945,\"lat\":-34.000042847800000,\"lon\":151.249547273000000},{\"id\":57946,\"lat\":-34.000166784300000,\"lon\":151.249487071000000},{\"id\":57947,\"lat\":-34.000562876300000,\"lon\":151.249663454000000},{\"id\":57948,\"lat\":-34.000691070200000,\"lon\":151.249902990000000},{\"id\":57949,\"lat\":-34.000928857200000,\"lon\":151.249748201000000},{\"id\":57950,\"lat\":-34.001046806000000,\"lon\":151.249941822000000},{\"id\":57951,\"lat\":-34.001237909200000,\"lon\":151.249880240000000},{\"id\":57952,\"lat\":-34.001312713000000,\"lon\":151.249740321000000},{\"id\":57953,\"lat\":-34.001466426100000,\"lon\":151.249748703000000},{\"id\":57954,\"lat\":-34.001617676800000,\"lon\":151.249584150000000},{\"id\":57955,\"lat\":-34.001585765200000,\"lon\":151.249365699000000},{\"id\":57956,\"lat\":-34.001813952000000,\"lon\":151.249211098000000},{\"id\":57957,\"lat\":-34.001497826800000,\"lon\":151.248583340000000},{\"id\":57958,\"lat\":-34.001562377400000,\"lon\":151.248397508000000},{\"id\":57959,\"lat\":-34.001407192200000,\"lon\":151.248285377000000},{\"id\":57960,\"lat\":-34.001082948000000,\"lon\":151.247761568000000},{\"id\":57961,\"lat\":-34.000804812800000,\"lon\":151.247778813000000},{\"id\":57962,\"lat\":-33.999671704800000,\"lon\":151.248424795000000},{\"id\":57963,\"lat\":-33.999678658400000,\"lon\":151.248240136000000},{\"id\":57964,\"lat\":-33.999454820700000,\"lon\":151.248025638000000},{\"id\":57965,\"lat\":-33.999023303500000,\"lon\":151.248057566000000},{\"id\":57966,\"lat\":-33.998944725300000,\"lon\":151.247932332000000},{\"id\":57967,\"lat\":-33.998791835100000,\"lon\":151.247981598000000},{\"id\":57968,\"lat\":-33.998688570500000,\"lon\":151.248145162000000},{\"id\":57969,\"lat\":-33.998421587800000,\"lon\":151.248111648000000},{\"id\":57970,\"lat\":-33.998246798300000,\"lon\":151.247813881000000},{\"id\":57971,\"lat\":-33.998285515000000,\"lon\":151.247450688000000},{\"id\":57972,\"lat\":-33.998206470000000,\"lon\":151.247294176000000},{\"id\":57973,\"lat\":-33.998206792800000,\"lon\":151.246931790000000},{\"id\":57974,\"lat\":-33.998503904600000,\"lon\":151.246638326000000},{\"id\":57975,\"lat\":-33.998511208000000,\"lon\":151.246476742000000},{\"id\":57976,\"lat\":-33.998063780900000,\"lon\":151.246137455000000},{\"id\":57977,\"lat\":-33.997878225500000,\"lon\":151.246207160000000},{\"id\":57978,\"lat\":-33.997766832800000,\"lon\":151.246162626000000}]}]}";

          //  response = "{\"success\":true,\"response\":\"Please collect all the map data with mapType as MARINEPARKZONES.\",\"data\":[{\"id\":806,\"color\":\"#b1c9a8\",\"mapType\":\"MARINE PARK ZONES\",\"topLeftLat\":-33.904195957784050,\"topLeftLon\":151.259455403859900,\"bottomRightLat\":-33.921003262483650,\"bottomRightLon\":151.272701493089200,\"mapPins\":[{\"id\":57979,\"lat\":-33.912137568600000,\"lon\":151.272158660000000},{\"id\":57980,\"lat\":-33.910758901600000,\"lon\":151.271629184000000},{\"id\":57981,\"lat\":-33.910416822000000,\"lon\":151.271401954000000},{\"id\":57982,\"lat\":-33.909787818200000,\"lon\":151.271236848000000},{\"id\":57983,\"lat\":-33.909534122100000,\"lon\":151.271059220000000},{\"id\":57984,\"lat\":-33.909056980500000,\"lon\":151.271139911000000},{\"id\":57985,\"lat\":-33.908428545900000,\"lon\":151.270948488000000},{\"id\":57986,\"lat\":-33.907900896600000,\"lon\":151.270891256000000},{\"id\":57987,\"lat\":-33.906880501500000,\"lon\":151.271222932000000},{\"id\":57988,\"lat\":-33.906404765600000,\"lon\":151.271185035000000},{\"id\":57989,\"lat\":-33.905885015900000,\"lon\":151.270915450000000},{\"id\":57990,\"lat\":-33.905356333200000,\"lon\":151.270840356000000},{\"id\":57991,\"lat\":-33.905085661600000,\"lon\":151.270702783000000},{\"id\":57992,\"lat\":-33.904487246400000,\"lon\":151.270094624000000},{\"id\":57993,\"lat\":-33.904195957800000,\"lon\":151.269623084000000},{\"id\":57994,\"lat\":-33.904700243600000,\"lon\":151.268653376000000},{\"id\":57995,\"lat\":-33.905066453000000,\"lon\":151.269002533000000},{\"id\":57996,\"lat\":-33.905109426200000,\"lon\":151.269310831000000},{\"id\":57997,\"lat\":-33.905568391600000,\"lon\":151.269788476000000},{\"id\":57998,\"lat\":-33.905824689400000,\"lon\":151.269690554000000},{\"id\":57999,\"lat\":-33.906616826600000,\"lon\":151.270133141000000},{\"id\":58000,\"lat\":-33.907151357600000,\"lon\":151.270032117000000},{\"id\":58001,\"lat\":-33.907244073200000,\"lon\":151.269906577000000},{\"id\":58002,\"lat\":-33.907920978500000,\"lon\":151.269789849000000},{\"id\":58003,\"lat\":-33.909013500100000,\"lon\":151.269932644000000},{\"id\":58004,\"lat\":-33.909152746600000,\"lon\":151.270063788000000},{\"id\":58005,\"lat\":-33.909484905800000,\"lon\":151.269866445000000},{\"id\":58006,\"lat\":-33.909870975800000,\"lon\":151.269838029000000},{\"id\":58007,\"lat\":-33.910112546300000,\"lon\":151.270227111000000},{\"id\":58008,\"lat\":-33.910705899200000,\"lon\":151.270307814000000},{\"id\":58009,\"lat\":-33.911083631500000,\"lon\":151.270619437000000},{\"id\":58010,\"lat\":-33.911545958600000,\"lon\":151.270710287000000},{\"id\":58011,\"lat\":-33.911706683600000,\"lon\":151.270851184000000},{\"id\":58012,\"lat\":-33.911991056400000,\"lon\":151.270938099000000},{\"id\":58013,\"lat\":-33.912166623900000,\"lon\":151.270913967000000},{\"id\":58014,\"lat\":-33.912233342800000,\"lon\":151.271082499000000},{\"id\":58015,\"lat\":-33.912683406700000,\"lon\":151.271052820000000},{\"id\":58016,\"lat\":-33.913180450300000,\"lon\":151.271619360000000},{\"id\":58017,\"lat\":-33.913800211800000,\"lon\":151.271396462000000},{\"id\":58018,\"lat\":-33.914235125800000,\"lon\":151.271398120000000},{\"id\":58019,\"lat\":-33.914331829900000,\"lon\":151.271161338000000},{\"id\":58020,\"lat\":-33.914580911500000,\"lon\":151.270937140000000},{\"id\":58021,\"lat\":-33.914740048300000,\"lon\":151.270500790000000},{\"id\":58022,\"lat\":-33.914842659200000,\"lon\":151.270065590000000},{\"id\":58023,\"lat\":-33.914796217300000,\"lon\":151.269236796000000},{\"id\":58024,\"lat\":-33.914224789800000,\"lon\":151.267644841000000},{\"id\":58025,\"lat\":-33.914074993400000,\"lon\":151.267453701000000},{\"id\":58026,\"lat\":-33.913868696100000,\"lon\":151.267428459000000},{\"id\":58027,\"lat\":-33.913591287600000,\"lon\":151.266881001000000},{\"id\":58028,\"lat\":-33.913662677600000,\"lon\":151.266726578000000},{\"id\":58029,\"lat\":-33.913934626300000,\"lon\":151.266538685000000},{\"id\":58030,\"lat\":-33.914483185700000,\"lon\":151.267539584000000},{\"id\":58031,\"lat\":-33.914852394300000,\"lon\":151.267991055000000},{\"id\":58032,\"lat\":-33.915174757200000,\"lon\":151.268249316000000},{\"id\":58033,\"lat\":-33.915961192800000,\"lon\":151.267686200000000},{\"id\":58034,\"lat\":-33.916163690400000,\"lon\":151.267440865000000},{\"id\":58035,\"lat\":-33.916213547000000,\"lon\":151.267151542000000},{\"id\":58036,\"lat\":-33.916333701800000,\"lon\":151.266978476000000},{\"id\":58037,\"lat\":-33.916291767300000,\"lon\":151.266438001000000},{\"id\":58038,\"lat\":-33.916090732000000,\"lon\":151.265741894000000},{\"id\":58039,\"lat\":-33.915415878900000,\"lon\":151.264775200000000},{\"id\":58040,\"lat\":-33.914861860600000,\"lon\":151.263037452000000},{\"id\":58041,\"lat\":-33.914756935800000,\"lon\":151.261896463000000},{\"id\":58042,\"lat\":-33.914886439100000,\"lon\":151.261402549000000},{\"id\":58043,\"lat\":-33.915260301600000,\"lon\":151.261204983000000},{\"id\":58044,\"lat\":-33.915551351000000,\"lon\":151.261366172000000},{\"id\":58045,\"lat\":-33.917319667300000,\"lon\":151.262889322000000},{\"id\":58046,\"lat\":-33.917734511000000,\"lon\":151.262887459000000},{\"id\":58047,\"lat\":-33.918059168100000,\"lon\":151.262684352000000},{\"id\":58048,\"lat\":-33.918047864500000,\"lon\":151.262301260000000},{\"id\":58049,\"lat\":-33.918365736200000,\"lon\":151.262006604000000},{\"id\":58050,\"lat\":-33.918448787700000,\"lon\":151.261703621000000},{\"id\":58051,\"lat\":-33.918387931500000,\"lon\":151.261645902000000},{\"id\":58052,\"lat\":-33.918501872000000,\"lon\":151.261597738000000},{\"id\":58053,\"lat\":-33.918584556500000,\"lon\":151.261268564000000},{\"id\":58054,\"lat\":-33.919097376000000,\"lon\":151.260865148000000},{\"id\":58055,\"lat\":-33.919412468800000,\"lon\":151.260760495000000},{\"id\":58056,\"lat\":-33.919921794400000,\"lon\":151.260881149000000},{\"id\":58057,\"lat\":-33.920101198400000,\"lon\":151.260831659000000},{\"id\":58058,\"lat\":-33.919996230400000,\"lon\":151.260355628000000},{\"id\":58059,\"lat\":-33.919759258200000,\"lon\":151.259974133000000},{\"id\":58060,\"lat\":-33.920502024400000,\"lon\":151.259455404000000},{\"id\":58061,\"lat\":-33.920714734800000,\"lon\":151.259681323000000},{\"id\":58062,\"lat\":-33.920951252900000,\"lon\":151.260378841000000},{\"id\":58063,\"lat\":-33.921002787600000,\"lon\":151.260875794000000},{\"id\":58064,\"lat\":-33.920893534400000,\"lon\":151.261349570000000},{\"id\":58065,\"lat\":-33.920667991600000,\"lon\":151.261673859000000},{\"id\":58066,\"lat\":-33.920285782500000,\"lon\":151.261910649000000},{\"id\":58067,\"lat\":-33.919944041900000,\"lon\":151.261963189000000},{\"id\":58068,\"lat\":-33.919433114500000,\"lon\":151.261912684000000},{\"id\":58069,\"lat\":-33.918821560300000,\"lon\":151.263263318000000},{\"id\":58070,\"lat\":-33.918529453300000,\"lon\":151.263608077000000},{\"id\":58071,\"lat\":-33.917932297100000,\"lon\":151.263943481000000},{\"id\":58072,\"lat\":-33.917577118900000,\"lon\":151.264005874000000},{\"id\":58073,\"lat\":-33.917189902300000,\"lon\":151.263965908000000},{\"id\":58074,\"lat\":-33.916517058300000,\"lon\":151.263567912000000},{\"id\":58075,\"lat\":-33.915774630200000,\"lon\":151.262881855000000},{\"id\":58076,\"lat\":-33.916235367300000,\"lon\":151.264218508000000},{\"id\":58077,\"lat\":-33.916915633300000,\"lon\":151.265303217000000},{\"id\":58078,\"lat\":-33.917172169500000,\"lon\":151.266200791000000},{\"id\":58079,\"lat\":-33.917235289300000,\"lon\":151.267022673000000},{\"id\":58080,\"lat\":-33.917175596800000,\"lon\":151.267367943000000},{\"id\":58081,\"lat\":-33.916856532600000,\"lon\":151.268134264000000},{\"id\":58082,\"lat\":-33.916480803900000,\"lon\":151.268571062000000},{\"id\":58083,\"lat\":-33.915694360300000,\"lon\":151.269134176000000},{\"id\":58084,\"lat\":-33.915731719000000,\"lon\":151.270250592000000},{\"id\":58085,\"lat\":-33.915553139800000,\"lon\":151.270991579000000},{\"id\":58086,\"lat\":-33.915273734800000,\"lon\":151.271630555000000},{\"id\":58087,\"lat\":-33.914653971500000,\"lon\":151.272356760000000},{\"id\":58088,\"lat\":-33.913474571800000,\"lon\":151.272685478000000},{\"id\":58089,\"lat\":-33.912911468500000,\"lon\":151.272652440000000},{\"id\":58090,\"lat\":-33.912346837200000,\"lon\":151.272172319000000},{\"id\":58091,\"lat\":-33.912137568600000,\"lon\":151.272158660000000}]}]}";
            JSONObject json = new JSONObject(response);

            if (json.has("success") && json.getString("success").equals("true")) {

                JSONArray posts = json.getJSONArray("data");

                for( int i=0; i<posts.length(); i++ )
                {
                    JSONObject object = posts.getJSONObject(i);

                    MapModel maplist = new MapModel();

                    maplist.id = object.isNull("bottomRightLon") ? "" : object.getString("bottomRightLon");
                    maplist.title = (object.isNull("topLeftLat") ? "" : object.getString("topLeftLat"));
                    maplist.desc = (object.isNull("topLeftLon") ? "" : object.getString("topLeftLon"));
                    maplist.color = (object.isNull("bottomRightLat") ? "" : object.getString("bottomRightLat"));
                    maplist.mapType = (object.isNull("mapType") ? "" : object.getString("mapType"));

                  //  JSONArray mappins = object.getJSONArray("mapPins");

                    for( int j=0; j< object.getJSONArray("mapPins").length(); j++ )
                    {
                        PinsModel pinslist = new PinsModel();

                        pinslist.id = (object.getJSONArray("mapPins").getJSONObject(j).isNull("id") ? "" : object.getJSONArray("mapPins").getJSONObject(j).getString("id"));
                        pinslist.lat = (object.getJSONArray("mapPins").getJSONObject(j).isNull("lat") ? "" : object.getJSONArray("mapPins").getJSONObject(j).getString("lat"));
                        pinslist.lon = (object.getJSONArray("mapPins").getJSONObject(j).isNull("lon") ? "" : object.getJSONArray("mapPins").getJSONObject(j).getString("lon"));
                        pinslist.mapType = (object.isNull("mapType") ? "" : object.getString("mapType"));

                        PinsList.add(pinslist);
                    }

                    maplist.setMapPins(PinsList);

                    MapList.add(maplist);
                }
            }

        } catch (JSONException e) {

            e.printStackTrace();
        }
    }
}